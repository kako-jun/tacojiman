# タコジマン - ゲーム動作仕様書

## 基本操作システム

### シングルタップ操作
ゲームは**指一本**で遊ぶシングルタップゲームです。

#### 操作パターン

| 操作 | 条件 | 動作 | 結果 |
|------|------|------|------|
| **短押し** | 敵に直接タップ | 即座に攻撃実行 | 1回攻撃 |
| **短押し** | 家をタップ | ボム忍術発動 | ボム使用 |
| **長押し開始** | 空いた場所をタップ | ズーム開始 | カメラがタップ位置にズームイン |
| **長押し終了** | ズーム中にタップ離し | ズーム中断 + 攻撃 | ズームアウト開始 + そのタップ位置で攻撃 |

#### ズームシステム
- **ズーム開始条件**: 敵がいない場所を300ms以上タップ
- **ズーム倍率**: 3倍
- **ズーム速度**: 1秒でズームイン、2秒でズームアウト
- **ズーム中断**: タップを離すと即座にズームアウト開始
- **戦略的意義**: ズームアウトしながら敵を正確にタップすることで倒す

## 敵システム

### 敵の種類と特徴

| 敵タイプ | 形状 | HP | 速度 | スコア | 出現場所 | 行動パターン |
|---------|------|----|----- |--------|----------|-------------|
| **地上歩行型** | 矩形 | 2 | 1.0 | 1 | 画面端 | 道路を規則正しく進軍 |
| **海上遡上型** | 円形 | 2 | 0.8 | 2 | 上端 | 一列縦隊で接近 |
| **空挺降下型** | 三角形 | 2 | 1.5 | 3 | 空から | ランダムな着地地点 |
| **地下掘削型** | 菱形 | 2 | 0.5 | 4 | 家の近く | 突然出現 |

### 敵のHP・ダメージシステム
- **初期HP**: 全敵タイプ共通で2HP
- **ダメージ**: 1回の攻撃で1ダメージ
- **撃破条件**: 2回攻撃で撃破
- **見た目変化**: HP2(赤色) → HP1(ピンク色)
- **枠線**: HP2(太い白枠) → HP1(細い白枠)

### 敵の残像システム
- **残像間隔**: 50ms間隔で残像作成
- **残像数**: 最大5個
- **残像時間**: 300msで消失
- **残像色**: 元の敵より薄い色
- **残像深度**: 敵より後ろに配置(depth: 90)

## 攻撃システム

### 通常攻撃
- **攻撃範囲**: タップ位置中心の半径80ピクセル
- **攻撃判定**: 範囲内の最初の敵に1ダメージ
- **視覚エフェクト**: 攻撃判定と同じ80ピクセル半径の円
- **エフェクト色**: ヒット時(黄色)、ミス時(灰色)
- **エフェクト時間**: 300msでフェードアウト

### タココング戦
- **出現タイミング**: ゲーム開始から2分50秒経過時
- **HP**: 見た目2HP、実質42回攻撃必要
- **攻撃判定**: 半径40ピクセル
- **特殊システム**: バリア→HP減少の段階的ダメージ

## ボム忍術システム

### ボム管理
- **初期ストック**: 1発
- **回復タイミング**: 1分後、2分後に各1発
- **最大ストック**: 1発（同時保持不可）
- **発動方法**: 家をタップ
- **ランダム選択**: 8種類からランダム

### ボム種類

#### 1. 浦恋菊流怒之術（プロトンビーム）
- **演出**: 2秒チャージ → 直線ビーム発射
- **効果**: 直線上の全敵に1ダメージ
- **範囲**: 画面全体

#### 2. 埋弟盆流怒之術（マッディボム）
- **演出**: 地雷設置（家から半径3マス以内）
- **効果**: 地下掘削型が近づくと自動爆発
- **持続**: 30秒間

#### 3. 千鳥臥流怒之術（セントリーガン）
- **演出**: 自動砲台設置（家から半径5マス以内）
- **効果**: 5秒間、0.2秒間隔で自動連射
- **射程**: 砲台中心から半径2マス

#### 4. 無敵ホーダイの術
- **演出**: 光エフェクト → 5連続ランダム爆撃
- **効果**: 各爆発で範囲内敵に2ダメージ
- **予告**: 0.5秒前に警告サークル表示

#### 5. SOLの術
- **演出**: 画面暗転 → 宇宙からビーム降下
- **効果**: 超広範囲に3ダメージ
- **ターゲティング**: 2秒間の照準表示

#### 6. ダインスレイブの術
- **演出**: 1秒チャージ → 貫通槍発射
- **効果**: 多段ヒット、最大5ダメージ
- **リスク**: 外すと完全無駄

#### 7. じゃくほうらいこうべんの術
- **演出**: 1.5秒チャージ → 巨大ミサイル
- **効果**: 大範囲に4ダメージ
- **特徴**: ソイフォンのばんかい風演出

#### 8. 分身の術
- **演出**: 煙幕 → 2つの分身出現
- **効果**: 5秒間敵を誘導
- **戦略**: 分身に敵を集めて一掃

## ゲーム進行システム

### 時間管理
- **開始時刻**: 7:00 AM固定
- **ゲーム時間**: 3分間（現実時間）
- **ゲーム内時間**: 30分進行（7:00→7:30）
- **表示**: 左上に朝番組風デジタル時計

### スコアシステム
- **敵撃破**: 敵タイプ別スコア（1-4点）
- **タココング撃破**: 100点
- **被ダメージ**: 家到達時に10点減点
- **ボム攻撃**: ボム種類別の追加スコア

### 敵スポーン
- **間隔**: 2秒ごと
- **最大数**: 同時50匹
- **重み**: 地上30%、海上25%、空25%、地下20%
- **家到達**: 25ピクセル以内で自動削除

## UI・演出システム

### カメラシステム
- **初期位置**: 家中心
- **ズーム中心**: タップ位置
- **ズーム継続**: 途中でズーム方向変更可能
- **回転**: 背景マップがゆっくり回転（現在無効化）

### エフェクトシステム
- **攻撃エフェクト**: 攻撃判定と完全一致
- **残像システム**: 全動的要素に軽い残像
- **深度管理**: UI(1000) > ボス(200) > 敵(100) > 残像(90) > 背景(0)
- **画面フラッシュ**: 削除済み（無音プレイ対応）

### 音響設計
- **BGM**: なし
- **SE**: 最小限（オフ可能）
- **環境音**: 蛸島の自然音（オプション）
- **基本方針**: 電車内無音プレイ完全対応

## 技術仕様

### パフォーマンス
- **フレームレート**: 60fps維持
- **同時表示**: 最大50匹の敵
- **エフェクト**: Canvas描画 → 最終版WebP

### 入力制御
- **タップ判定**: 80ピクセル範囲（指が隠れる範囲）
- **長押し判定**: 300ms
- **重複防止**: シングルタップのみ、重複攻撃なし
- **ズーム判定**: 敵の攻撃範囲内タップではズーム開始しない

### データ管理
- **敵データ**: config.tsで型安全に定義
- **ボムデータ**: 8種類の忍術を配列管理
- **設定**: ローカルストレージ保存
- **ランキング**: NostalgicアプリAPI連携

## 戦略的ゲームプレイ

### コアメカニクス
1. **全体俯瞰**: どこに敵が集まっているかを瞬時に把握
2. **脅威判断**: どの敵が家にたどり着きそうかを予測
3. **ズーム戦略**: どの範囲をズームして連続攻撃するか
4. **タイミング**: ズームアウト中に正確に敵をタップ
5. **ボム運用**: 限られたボムの効果的な使用タイミング

### 難易度設計
- **基本方針**: ズームを使わないと勝てないバランス
- **フラッピーバード級**: 高い集中力と技術が必要
- **理不尽要素**: 運ではなく技術で上達可能
- **電車内プレイ**: つり革につかまりながら片手でプレイ可能